<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do List: Cloud Sync Edition ‚òÅÔ∏è</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚òÅÔ∏è</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        /* CSS ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á */
        :root { --light-primary: #6d28d9; /* ... */ } [data-theme="light"] { /* ... */ } [data-theme="dark"] { /* ... */ } * { margin: 0; padding: 0; box-sizing: border-box; } body { font-family: 'Poppins', sans-serif; background: var(--background-color); color: var(--text-color); display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; padding: 40px 20px; transition: background-color 0.3s, color 0.3s; }
        .container { background: var(--card-background); padding: 30px; border-radius: 20px; box-shadow: var(--shadow); width: 100%; max-width: 650px; transition: all 0.4s ease; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        header h1 { font-weight: 600; color: var(--primary-color); }
        .input-area { display: flex; margin-bottom: 20px; }
        #task-input { flex-grow: 1; min-width: 0; padding: 12px 15px; border: 1px solid var(--border-color); background: var(--background-color); color: var(--text-color); border-radius: 10px 0 0 10px; font-size: 16px; transition: all 0.3s; }
        #add-task-btn { padding: 12px 20px; border: none; background: var(--primary-color); color: white; border-radius: 0 10px 10px 0; cursor: pointer; font-size: 16px; font-weight: 500; transition: background-color 0.3s; white-space: nowrap; }
        #task-list { list-style-type: none; }
        .task-item { display: flex; align-items: center; gap: 10px; padding: 15px; border-bottom: 1px solid var(--border-color); user-select: none; }
        .task-item.done .task-text { text-decoration: line-through; color: var(--text-secondary-color); }
        .task-content { flex-grow: 1; min-width: 0; cursor: pointer;}
        .task-text { font-size: 16px; word-break: break-word; }
        .task-details { display: flex; align-items: center; gap: 10px; margin-top: 4px; flex-wrap: wrap; }
        .task-timestamp { font-size: 12px; color: var(--text-secondary-color); }
        .priority-tag { font-size: 10px; font-weight: 600; padding: 2px 8px; border-radius: 10px; background-color: #fee2e2; color: #dc2626; }
        [data-theme="dark"] .priority-tag { background-color: #7f1d1d; color: #fecaca; }
    </style>
</head>
<body>

    <div class="container">
        <header> <h1>To-Do: Cloud Sync ‚òÅÔ∏è</h1> </header>
        <div class="input-area"> <input type="text" id="task-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."> <button id="add-task-btn">‡πÄ‡∏û‡∏¥‡πà‡∏°</button> </div>
        <ul id="task-list"></ul>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
        // 2. ‡∏ß‡∏≤‡∏á FIREBASE CONFIG ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà!
        const firebaseConfig = {
  apiKey: "AIzaSyANkkp8y0BiJlj5YscdRP7MxrsldAn5ei0",
  authDomain: "my-ultimate-todo.firebaseapp.com",
  projectId: "my-ultimate-todo",
  storageBucket: "my-ultimate-todo.firebasestorage.app",
  messagingSenderId: "333436474367",
  appId: "1:333436474367:web:d17d050e13ef503f5d0dca",
  measurementId: "G-HZM1HQMWRX"
};

        // 3. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const tasksCollection = db.collection('tasks');

        document.addEventListener('DOMContentLoaded', () => {
            const taskInput = document.getElementById('task-input');
            const addTaskBtn = document.getElementById('add-task-btn');
            const taskList = document.getElementById('task-list');

            const getPriority = (text) => {
                const lowerText = text.toLowerCase();
                const highPriorityKeywords = ['‡∏î‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î', '‡∏î‡πà‡∏ß‡∏ô‡∏°‡∏≤‡∏Å', '‡∏î‡πà‡∏ß‡∏ô', 'urgent', 'asap', '‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à', '‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å', '‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ', '‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ'];
                return highPriorityKeywords.some(keyword => lowerText.includes(keyword));
            };

            // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ß‡∏≤‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° ‡πÅ‡∏ï‡πà‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å DB)
            const renderTask = (doc) => {
                const task = doc.data();
                const li = document.createElement('li');
                li.className = 'task-item';
                li.dataset.id = doc.id; // ‡πÉ‡∏ä‡πâ ID ‡∏à‡∏≤‡∏Å Firestore
                if (task.done) li.classList.add('done');

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = task.done;
                checkbox.addEventListener('change', () => toggleTask(doc.id, task.done));

                const contentDiv = document.createElement('div');
                contentDiv.className = 'task-content';
                contentDiv.addEventListener('click', () => toggleTask(doc.id, task.done));
                
                const textSpan = document.createElement('span');
                textSpan.className = 'task-text';
                textSpan.textContent = task.text;

                const detailsDiv = document.createElement('div');
                detailsDiv.className = 'task-details';
                const timeStampDiv = document.createElement('div');
                timeStampDiv.className = 'task-timestamp';
                timeStampDiv.textContent = new Date(task.createdAt).toLocaleString('th-TH');
                detailsDiv.appendChild(timeStampDiv);

                if (task.isHighPriority) {
                    const priorityTag = document.createElement('span');
                    priorityTag.className = 'priority-tag';
                    priorityTag.textContent = 'üí• ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å';
                    detailsDiv.appendChild(priorityTag);
                }

                contentDiv.appendChild(textSpan);
                contentDiv.appendChild(detailsDiv);

                // ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = '‡∏•‡∏ö';
                deleteBtn.style.marginLeft = 'auto'; // Move to the right
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteTask(doc.id);
                });

                li.appendChild(checkbox);
                li.appendChild(contentDiv);
                li.appendChild(deleteBtn);
                taskList.appendChild(li);
            };

            // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö Firestore ---

            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
            const addTask = () => {
                const taskText = taskInput.value.trim();
                if (taskText === '') return;

                tasksCollection.add({
                    text: taskText,
                    done: false,
                    isHighPriority: getPriority(taskText),
                    createdAt: Date.now()
                });

                taskInput.value = '';
                taskInput.focus();
            };

            // ‡∏™‡∏•‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô
            const toggleTask = (id, currentStatus) => {
                tasksCollection.doc(id).update({ done: !currentStatus });
            };

            // ‡∏•‡∏ö‡∏á‡∏≤‡∏ô
            const deleteTask = (id) => {
                if(confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                    tasksCollection.doc(id).delete();
                }
            };
            
            // --- ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å ---
            addTaskBtn.addEventListener('click', addTask);
            taskInput.addEventListener('keypress', e => e.key === 'Enter' && addTask());

            // Real-time listener: ‡∏ü‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏à‡∏≤‡∏Å DB ‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤!
            tasksCollection.orderBy('createdAt', 'desc').onSnapshot(snapshot => {
                taskList.innerHTML = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
                snapshot.forEach(doc => {
                    renderTask(doc);
                });
            });
        });
    </script>
</body>
</html>
